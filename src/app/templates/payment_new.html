{% extends "base.html" %}
{% block content %}
  <section class="panel panel-narrow">
    <div class="section-head">
      <div>
        <h1>Создать платеж</h1>
        <p class="hint">Для авто-сверки используется уникальная сумма (`base_amount + offset`). Клиенту нужно перевести ровно указанную сумму.</p>
      </div>
    </div>
    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}
    <form method="post" action="/admin/payments/new">
      <label>
        Название
        <input type="text" name="title" required value="{{ values.title or '' }}" placeholder="Например: Доступ к приватному каналу">
      </label>
      <label>
        Внешний ID (опционально)
        <input type="text" name="external_id" value="{{ values.external_id or '' }}" placeholder="order-1001">
      </label>
      <label>
        Сеть
        <select name="network" required>
          {% for option in network_options %}
            <option value="{{ option.code }}" {% if values.network == option.code %}selected{% endif %} {% if not option.configured %}disabled{% endif %}>
              {{ option.title }} {% if not option.configured %}(wallet не настроен){% endif %}
            </option>
          {% endfor %}
        </select>
      </label>
      <div class="hint-list">
        {% for option in network_options %}
          <div>{{ option.title }}: {{ option.wallet or "wallet не указан" }}, подтверждений: {{ option.required_confirmations }}</div>
        {% endfor %}
      </div>
      <div class="form-row">
        <label>
          Сумма (USDT)
          <input type="text" name="base_amount" required value="{{ values.base_amount or '' }}" placeholder="50.00">
        </label>
        <label>
          Время жизни (минуты)
          <input type="number" name="ttl_minutes" min="1" max="1440" value="{{ values.ttl_minutes or default_ttl }}">
        </label>
      </div>
      <label>
        Описание
        <textarea name="description" placeholder="Описание для клиента">{{ values.description or '' }}</textarea>
      </label>
      <div class="actions">
        <button id="create-btn" class="btn btn-primary" type="submit">Создать платеж</button>
        <a class="btn btn-outline" href="/admin">Отмена</a>
      </div>
    </form>
  </section>
  <script>
    (function () {
      const form = document.querySelector("form");
      const btn = document.getElementById("create-btn");
      if (!form || !btn) {
        return;
      }
      form.addEventListener("submit", function () {
        btn.disabled = true;
        btn.textContent = "Создание...";
      });
    })();
  </script>
{% endblock %}
